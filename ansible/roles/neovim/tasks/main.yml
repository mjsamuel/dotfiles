- name: install dependencies (macOS)
  community.general.homebrew:
    name:
      - ninja
      - cmake
      - gettext
      - curl
    state: present
    update_homebrew: no
  when: ansible_os_family == "Darwin"

- name: install dependencies (Debian)
  ansible.builtin.apt:
  name:
    - ninja-build
    - gettext
    - cmake
    - unzip
    - curl
  state: present
  become: yes
  when: ansible_os_family == "Debian"

- name: clone repository
  git:
    repo: https://github.com/neovim/neovim
    dest: "{{ workdir }}"
    force: yes
    clone: true
  register: clone

- name: build
  make:
    chdir: "{{ workdir }}"
    params:
      CMAKE_BUILD_TYPE: RelWithDebInfo
  when: clone is changed

- name: install
  make:
    chdir: "{{ workdir }}"
    target: install
  become: yes
  when: clone is changed

- name: insall plugins
  shell: nvim --headless "+Lazy! sync" +qa
  when: clone is changed
